## 购物车存储方案对比

### 方案1：**Redis + 数据库**（推荐）

- **用户未登录时**：存Redis，key为临时token
- **用户登录后**：同步到数据库，并合并临时购物车
- **登录状态**：查数据库，并缓存到Redis

### 方案2：**纯Redis**

- 所有购物车数据存Redis
- 优点：性能高
- 缺点：数据可能丢失（除非持久化）



###### 3. **存在的问题**

###### 问题1：**没有持久化到数据库**

- 如果Redis重启/宕机，购物车数据会丢失
- 无法做历史数据分析
- 无法做数据备份

###### 问题2：**临时用户购物车未处理**

- 只支持已登录用户
- 未登录用户无法使用购物车

问题3：**缺少数量验证**

```
cartItem.setCount(cartItem.getCount() + 1);  // 没有检查库存限制
```

问题4：**没有价格同步**

```
// 价格是加入时的价格，不会更新
CartItemDto cartItem = cartConverter.sku2CartItem(skuInfo);
// 如果商品降价/涨价，购物车价格不会同步
```



### 方案3：**纯数据库**

- 所有购物车数据存MySQL
- 优点：数据安全
- 缺点：性能相对较低



