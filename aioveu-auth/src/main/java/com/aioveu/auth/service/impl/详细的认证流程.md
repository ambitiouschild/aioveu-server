


详细的认证流程

当调用 authenticationManager.authenticate(authenticationToken)时，Spring Security会执行以下流程：


1. 提取认证信息
 UsernamePasswordAuthenticationToken authenticationToken =
   new UsernamePasswordAuthenticationToken(username.trim(), password);
   // 包含：principal="admin", credentials="用户输入的密码", authenticated=false


2. 触发认证管理器

authenticationManager.authenticate()内部会：

```
public Authentication authenticate(Authentication authentication) {
    String username = authentication.getName();        // "admin"
    String rawPassword = (String) authentication.getCredentials();  // 用户输入的明文密码
    
    // 2.1 调用您的 UserDetailsService
    UserDetails userDetails = sysUserDetailsService.loadUserByUsername(username);
    // 返回的userDetails包含：用户名、数据库中的加密密码、权限等
    
    // 2.2 这里发生密码校验！
    if (!passwordEncoder.matches(rawPassword, userDetails.getPassword())) {
        throw new BadCredentialsException("密码错误");
    }
    
    // 2.3 创建已认证的令牌
    return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
}
```
