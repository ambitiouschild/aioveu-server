spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${mysql.host}:${mysql.port}/aioveu_oauth2_server?zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&autoReconnect=true
    username: ${mysql.username}
    password: ${mysql.password}
  data:
    redis:
      database: ${redis.database}
      host: ${redis.host}
      port: ${redis.port}
      password: ${redis.password}
      lettuce:
        pool:
          min-idle: 1

  cache:
    # 缓存类型 redis、none(不使用缓存)
    type: redis
    # 缓存时间(单位：ms)
    redis:
      time-to-live: 3600000
      # 缓存null值，防止缓存穿透
      cache-null-values: true

feign:
  httpclient:
    enabled: true
  okhttp:
    enabled: false
  sentinel:  # 开启feign对sentinel的支持
    enabled: false

mybatis-plus:
  configuration:
    # 驼峰下划线转换
    map-underscore-to-camel-case: true
    # 这个配置会将执行的sql打印出来，在开发或测试的时候可以用
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    default-enum-type-handler: org.apache.ibatis.type.EnumOrdinalTypeHandler

# 微信小程序
wx:
  miniapp:
    appId: "wx977b2949b7095b11"
    appSecret: "4bf78af93a8ce49f2de5384ede86be63"

# springdoc-openapi项目配置
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
    # 设置基础路径
    servers:
      - url: /api/v1/auth
        description: 认证服务接口

  group-configs:
    - group: 'default'  # 改为 default，不使用服务名
      display-name: '认证服务'  # 显示名称
      paths-to-match: '/api/v1/auth/**'  # 匹配的路径
      packages-to-scan: com.aioveu.auth.controller
      # 禁用自动添加分组名
      add-group-to-path: false


  # Api文档信息
  info:
    title: 认证服务
    version: 3.0.0
    description: 认证、登出、验证码接口
    contact:
      name: aioveu
      url: https://www.aioveu.com
      email: ambitiouschild@qq.com
    license:
      name: Apache 2.0
      url: https://www.apache.org/licenses/LICENSE-2.0.html

# knife4j的增强配置，不需要增强可以不配
knife4j:
  # ✅ 必须设置为 true
  enable: true
  # 开发环境设为 false
  production: false
  setting:
    # 基础配置-------------
    language: zh_cn
    enable-version: true
    # ✅ 开启重载功能
    enable-reload: true
    enable-open-api: true

    # 调试和缓存-------------
    # 启用调试模式
    enable-debug: true
    # 启用请求缓存
    enable-request-cache: true
    # 自动添加认证头
    enable-filter-multipart-apimethod: 4
    # Token 自动管理
    enable-after-script: true

    # 搜索和国际化-------------
    enable-search: true
    enable-i18n: true





# 验证码配置
captcha:
  # 验证码类型 circle-圆圈干扰验证码|gif-Gif验证码|line-干扰线验证码|shear-扭曲干扰验证码
  type: circle
  # 验证码宽度
  width: 120
  # 验证码高度
  height: 40
  # 验证码干扰元素个数
  interfere-count: 2
  # 文本透明度(0.0-1.0)
  text-alpha: 0.8
  # 验证码字符配置
  code:
    # 验证码字符类型 math-算术|random-随机字符
    type: math
    # 验证码字符长度，type=算术时，表示运算位数(1:个位数运算 2:十位数运算)；type=随机字符时，表示字符个数
    length: 1
  # 验证码字体
  font:
    # 字体名称 Dialog|DialogInput|Monospaced|Serif|SansSerif
    name: SansSerif
    # 字体样式 0-普通|1-粗体|2-斜体
    weight: 1
    # 字体大小
    size: 24
  # 验证码有效期(秒)
  expire-seconds: 120

# security1:
#   whitelist-paths:
#     - /api/v1/auth/captcha
#     - /api/v1/auth/sms_code


# 安全配置
security:
  session:
    # 会话方式 jwt/redis-token
    type: GetKeyPairAndGenerateJwtTokenWithPrivateKey
    # 访问令牌 有效期(单位：秒)，默认 2 小时，-1 表示永不过期
    access-token-time-to-live: 7200
    # 刷新令牌有效期(单位：秒)，默认 7 天，-1 表示永不过期
    refresh-token-time-to-live: 604800
    jwt:
      # JWT密钥(HS256算法至少32字符)
      secret-key: SecretKey012345678901234567890123456789012345678901234567890123456789
    redis-token:
      # 是否允许多设备登录
      allow-multi-login: true
  # 安全白名单路径，仅跳过 AuthorizationFilter 过滤器，还是会走 Spring Security 的其他过滤器(CSRF、CORS等)
  ignore-urls:
    - /api/v1/auth/login/**       # 登录接口(账号密码登录、手机验证码登录和微信登录)
    - /api/v1/auth/captcha        # 验证码获取接口
    - /api/v1/auth/refresh-token  # 刷新令牌接口
    - /api/v1/auth/logout         # 开放退出登录
    - /ws/**                      # WebSocket接口
  # 非安全端点路径，完全绕过 Spring Security 的安全控制
  unsecured-urls:
    - ${springdoc.swagger-ui.path}
    - /doc.html
    - /swagger-ui/**
    - /v3/api-docs/**
    - /v3/api-docs/swagger-config  # 明确添加
    - /webjars/**
    - /favicon.ico


    # system 的 Nacos 配置
management:
  health:
    mail:
      # 禁用邮件健康检查
      enabled: false